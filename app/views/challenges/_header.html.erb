<div id='challenge-header' class='<%= controller_name %>'>
  <div class="container">
    <div class="row">
      <div class="col-sm-10 col-sm-offset-1">

        <div id='challenge-nav'>
          <% Challenge::STAGES.each_with_index do |stage, index| %>
            <% current_stage = stage[:name] == @challenge.active_stage %>
            <% selected_stage = @challenge.stage_number > 4 || eval("params[:#{stage[:name]}_stage_id] || @#{stage[:name]}_stage") %>
            <% past_stage = @challenge.stage_number >= stage[:number] %>

            <%= link_to eval("challenge_#{stage[:name]}_stage_path(@challenge, @challenge.#{stage[:name]}_stage)"), class:
              "stage-container
                default_stage
                #{ 'past_stage' if past_stage }
                #{ 'current_stage' if current_stage }
                #{ 'selected_stage' if selected_stage }
                #{stage[:name]}" do %>

              <div class='body'>
                <i class="fa fa-2x <%= stage[:icon] %> <%= "text-#{stage[:name]}" if current_stage %>"></i>

                <div class='headline'><%= stage[:headline] %></div>
                <div class='headline-xs'><%= stage[:headline].split(' ').first %></div>
              </div>

              <div class="bottom-bar <%= @challenge.active_stage if past_stage %>">
                <div class="in-progress">
                </div>
              </div>

              <div class="descriptor-container">

                <% if stage[:number] <= @challenge.stage_number %>
                  <!-- We don't want to display 0 counts. -->
                  <% activity_count = eval("@challenge.#{stage[:name]}_stage.#{stage[:name].pluralize}.size") %>
                  <% if activity_count > 0 %>
                    <div class="descriptor-count"><%= activity_count %></div>
                    <div class="descriptor-body"><%= "#{stage[:alias].pluralize.capitalize} #{stage[:action]}" %></div>
                  <% end %>
                <% end %>
              </div>

            <% end %>
          <% end %>
        </div>

      </div>
    </div>
  </div>
</div>
